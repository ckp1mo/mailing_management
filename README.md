# Приложение для рассылок электронных писем. 
В приложении используются:
- фреймворк Django
- базы данных postgresql
- брокер redis для кэша данных.

Приложение позволяет создавать рассылки для отправки их через электронную почту по заданному интервалу времени.
На выбор предоставляется время начала и конца рассылки и частота рассылки. Частота рассылки: раз в день, раз в неделю и раз в месяц.

Пользователи разделены на роли:
Пользователь - обычный пользователь, который создает клиентов, сообщения и рассылки для них, не может писать статьи в блоге;
Менеджер - менеджер, может блокировать пользователей и рассылки. Менеджер не имеет статус персонала. Необходимый функционал
обеспечен экранами.
Контент-менеджер - наполняет блог статьями через админку.
Для приложения применено разделение прав доступа и кеширование данных. 

Команды:
- python3 manage.py migrate - провести миграции;
- python3 manage.py mailing_start - ручной запуск отправки рассылки, отправка произойдет при соблюдении условий рассылки;
- python3 manage.py mailing_start_now - принудительная отправка всех активных рассылок, игнорируя условия отправки;
- python3 manage.py csu - создать суперпользователя. email: admin@mailing.com, password: qwerty12 ;
- python3 manage.py start_apscheduler - запуск планироващика. Планировщик запускает скрипт на отправку писем каждую минуту, в скрипте содержится проверка на соблюдение условий для отправки писем.

Для простоты тестирования проверки логики отправки сообщений пользователям можно изменить некоторые данные в коде.
Сейчас расскажу что можно для этого сделать. 
Для этого в файле main_app/services.py на 30 строке кое-что подправить. Строка выглядит следующим образом.

    # time_delta = (time_now - time_log.time).seconds / 60 / 60 / 24  # значением этого выражением будет колличество дней
Значение time_delta равно в секундах, и если разделить только на 60, то получим значение в минутах. Если разделить еще раз на 60,
тогда значение уже будет в часах, ну понятна логика.. Полученное значение сравнивается в условиях кода на строках 32, 36 и 40.
По желанию идем main_app/management/commands/mailing_start.py и коментим 26 строчку, и добавляем какой нить принт строчкой ниже,
для вывода информации в консоль, например, который ниже. Просто потому что можно словить временный бан за спам на сутки.

    # print('Рассылка прошла успешно')
Подставляйте удобные значения для проверки работоспособности.

# Для запуска этого еще недостаточно. 
1. В проекте используется почтовый сервис Yandex, если у вас такой же, тогда достаточно будет заполнить два поля ниже.
Если другой почтовый сервис, тогда идем config/settings.py строки 132-136 и подставляем нужные значения.
В почтовом сервисе нужно установить разрешения для отправки писем сторонними програмамми, получить пароль к приложению.
2. Чтобы использовать кэширование в вэб-приложении нужно будет установить redis. Ссылка на документацию ниже.
https://redis.io/docs/install/install-redis/
3. Создаем базу данных в postgresql. Заходим в терминал/командную строку и вводим команды: 
   - psql -U postgres   # posgres - это имя пользователя для доступа в бд
   - create database my_data;  # my_data - имя будущей базы данных, имя можно любое(команда может с первого раза не сработать)
4. Заполняем переменные среды. В корне проекта нужно создать файл ".env" и заполнить следующие поля.
- USER=postgres     # имя пользователя в postgresql по дефолту postgres
- PASSWORD=your_password     # пароль для пользователя postgresql
- NAME=your_data_base_name     # имя базы данных
- EMAIL_HOST_USER=your@email.com     # почта для отправки писем 
- EMAIL_HOST_PASSWORD=your_email_password      # пароль к почтовому приложению 
- CACHE_ENABLED=False      # Кэш выключен. Для включения установить True
5. В проекте присутствуют две фикстуры, они заполняют проект контентом, но можно и без них.
Команды для загрузки фикстур:
- python3 manage.py loaddata main_app_data.json
- python3 manage.py loaddata blog_data.json
6. Запуск сервера командой "python3 manage.py runserver" и попасть на него по адресу http://127.0.0.1:8000 .

Вот в принципе и все)